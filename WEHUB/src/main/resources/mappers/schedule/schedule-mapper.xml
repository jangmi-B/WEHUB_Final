<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.kh.wehub.schedule.model.dao.ScheduleDao">


	<resultMap type="DateData" id="ScheduleResultMap">
		<id property="cal_no" column="CAL_NO"/>
		<result property="user_no" column="USER_NO"/>
		<result property="year" column="CAL_YEAR"/>
		<result property="month" column="CAL_MONTH"/>
		<result property="date" column="CAL_DAY"/>
		<result property="schedule_content" column="CAL_CONTENT"/>
		<result property="schedule_date" column="CAL_DATE"/>
	</resultMap>

	<select id="selectCalendar" parameterType="map" resultMap="ScheduleResultMap">
		SELECT M.USER_NO, C.CAL_NO, C.CAL_CONTENT, C.CAL_DATE, C.CAL_YEAR, C.CAL_MONTH, C.CAL_DAY
		FROM CALENDAR C
		JOIN MEMBER M ON(M.USER_NO = C.USER_NO)
		WHERE M.USER_NO = #{userNo}
	</select>
	
	<insert id="insertCalendar" parameterType="map"
			useGeneratedKeys="true" keyProperty="cal_no" keyColumn="CAL_NO">
		INSERT INTO CALENDAR VALUES(
		SEQ_CAL_NO.NEXTVAL,
		#{userNo},
		#{year},
		#{month},
		#{dayNo},
		#{text},
		SYSDATE
		)
	</insert>

	<update id="updateCalendar" parameterType="map">
		UPDATE CALENDAR
		SET
			CAL_CONTENT = #{text},
			CAL_DATE = SYSDATE
		WHERE
			CAL_NO = #{calNo}
	</update>

	<select id="todaySchedule" parameterType="map" resultMap="ScheduleResultMap">
		SELECT M.USER_NO, C.CAL_NO, C.CAL_CONTENT, C.CAL_DATE, C.CAL_YEAR, C.CAL_MONTH, C.CAL_DAY
		FROM CALENDAR C
		JOIN MEMBER M ON(M.USER_NO = C.USER_NO)
		WHERE M.USER_NO = #{userNo}
		AND C.CAL_YEAR = #{year}
		AND C.CAL_MONTH = #{month}
		AND C.CAL_DAY = #{today}
	</select>

</mapper>